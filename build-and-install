#!/bin/bash

#	Configure, make and install wx to /usr/local
#
#	Neil Mayhew - 2010-04-22

set -e

trap '[ $? -eq 0 ] || echo "FAILED!"' 0

PREFIX=/usr/local
CONFIGURATION=(
	--enable-unicode --enable-debug --prefix="$PREFIX"
)

revpath()
{
	sed 's#[^/]*#..#g' <<<"$1"
}

wx-version()
{
	sed -n '/wxVERSION_STRING/s/.*"wxWidgets \(.*\)".*/\1/p' "$1/include/wx/version.h"
}

SRC=${1:-.}
BUILD=build-ud-$(wx-version "$SRC")
case "$SRC" in
([^/]*) SRC=$(revpath $BUILD)/$SRC;;
esac
SRC=${SRC%/.}

rm -rf $BUILD
mkdir -p $BUILD
cd $BUILD

echo
echo "Configuring in $BUILD"
echo "Output redirected to $BUILD/configure.out"

${SRC}/configure "${CONFIGURATION[@]}" &>configure.out

echo
echo "Making in $BUILD"
echo "Output redirected to $BUILD/make.out"

make "${@:2}" &>make.out

echo
echo "Installing from $BUILD"
echo "Output redirected to $BUILD/install.out"

sudo -v -p "Enter password for sudo make install: "
sudo make install &>install.out
