#!/bin/bash

#	Configure and make wx using the current git branch name
#
#	Neil Mayhew - 2010-04-20

set -e

SRC=../wxWidgets
CONFIGURATION=(--enable-unicode --enable-debug)

revpath()
{
	sed 's#[^/]*#..#g' <<<"$1"
}

git-branch-name()
{
	git describe --contains --all --always ${1:-HEAD}
}

BRANCH=$(cd $SRC; git-branch-name)
SRC=$(revpath $BRANCH)/$SRC

rm -rf $BRANCH
mkdir -p $BRANCH
cd $BRANCH

$SRC/configure "${CONFIGURATION[@]}"
make
make install DESTDIR=$(pwd)/destdir
